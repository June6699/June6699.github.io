# 图片与构建说明

## 0. 哪些 img 下的文件夹可以删？图片是怎么到 HTML 的？

**可以删的**（文章 body 用图已迁到「一套图」流程后）：
- **img/HICPlot/**：HiCPlot 已用 `asset-dir: HiCPlot.assets`，图在 `_posts/HiCPlot.assets/`，构建前脚本会复制到 `assets/HiCPlot.assets/`，HTML 从那里读，所以可以删掉 **img/HICPlot**。
- **img/Win11_right_click/**：Win11 已改为 `asset-dir: Win11-Right-Click.assets`。请先新建 `_posts/Win11-Right-Click.assets/`，把 `img/Win11_right_click/` 下的两个文件（图片和 .txt）移进去，运行一次 `python sync_img_posts.py 3` 后再删 **img/Win11_right_click**。

**不要删的**：
- **img/flowers/**、**img/404-bg.jpg**、**favicon** 等：全站头部图、图标用，和文章 body 图无关。

**图片是怎么到 HTML 的**（简要）：
1. 你只在 **一份** 图：和 md 同级的 `XXX.assets`（如 `_posts/HiCPlot.assets/`），md 里写 `![](./HiCPlot.assets/xxx.png)`，Typora 直接读这份。
2. 构建前运行 **`python sync_img_posts.py 3`**：脚本把 `_posts/HiCPlot.assets/` **复制**到 **`assets/HiCPlot.assets/`**（不移动、不删源）。
3. Jekyll 构建时会把 **`assets/`** 原样拷到 `_site`，所以线上能访问 `/assets/HiCPlot.assets/xxx.png`。
4. **Layout 替换**：`_layouts/post.html` 里，若文章有 `asset-dir: HiCPlot.assets`，会把正文里的 `./HiCPlot.assets/` 替换成 `{{ site.baseurl }}/assets/HiCPlot.assets/`，所以最终 HTML 里的 `src` 指向上面这一步生成的地址。
总结：**源只有一份（_posts 下），脚本复制到 assets/，layout 把相对路径改成 /assets/…，HTML 就能显示。**

---

## 1. 头部图（Home / About / Tags）完整显示

- **改法**：在 `page.html` 和 `tags.html` 的 `<header class="intro-header">` 上增加了 class `intro-header-full`。
- **样式**：在 `hux-blog.less` / `hux-blog.css` 里为 `.intro-header.intro-header-full` 设置了 `background-size: contain` 和 `min-height`。
- **原因**：默认是 `background-size: cover`，会裁切图片填满区域；改成 `contain` 后整张图都会显示，两侧或上下可能留灰边，用 `min-height` 保证有足够高度看到图。

## 2. 文章插图：一套图，Typora 和 HTML 共用

- **约定**：图片只放在 `_posts` 下与文章对应的**无日期**文件夹里，例如 `_posts/HiCPlot.assets/`（和 md 的「逻辑名」一致，不带日期）。
- **md 里怎么写**：在正文里用相对路径，例如 `![](./HiCPlot.assets/xxx.png)`。Typora 会按「与 md 同级目录」去找，所以会读到 `_posts/HiCPlot.assets/`。
- **HTML 怎么看到图**：Jekyll 不会把 `_posts` 里的子目录当静态资源发布，所以构建前需要把「同一套图」复制到站点可访问的目录：
  - 运行 **`python sync_img_posts.py 3`**（或 bat 选 3），会把 `_posts/HiCPlot.assets/` 复制到 **`assets/HiCPlot.assets/`**。
  - 在 `_layouts/post.html` 里，如果文章 front matter 有 **`asset-dir: HiCPlot.assets`**，会把正文里的 `./HiCPlot.assets/` 替换成 `{{ site.baseurl }}/assets/HiCPlot.assets/`，所以 HTML 会从 `assets/` 加载同一套图。
- **为什么是「复制」而不是直接读 _posts**：GitHub Pages / Jekyll 只会发布 `_site` 里的内容，而 `_posts` 下的非 .md 文件不会被拷贝到 `_site`，所以必须通过脚本在构建前复制到 `assets/`，这样既保留「只在 _posts 下维护一份图」的约定，又让线上能访问。

## 3. md 文件名无日期（与 assets 一致）

- 本站已改用 **Jekyll collection**：文章放在 **`_articles/`**，文件名**无日期**，与 assets 文件夹名一致。
  - 例如：`_articles/HiCPlot.md`、`_articles/Win11-Right-Click.md`、`_articles/test.md`。
  - 日期写在 front matter 的 **`date`** 里，用于排序和显示。
- 图片仍在 **`_posts/`** 下：`_posts/HiCPlot.assets/`、`_posts/Win11-Right-Click.assets/` 等，构建前用脚本复制到 `assets/`。

## 4. 新文章怎么接上这一套

1. 在 **`_articles/`** 里新建 **`你的标题.md`**（无日期，与 assets 名一致）。
2. 在 **`_posts/`** 下建文件夹 **`你的标题.assets`**，图片都放这里。
3. 在 md 的 front matter 里写 **`date`** 和 **`asset-dir`**：
   ```yaml
   date: 2026-02-07
   asset-dir: 你的标题.assets
   ```
4. 正文里用 **`![](./你的标题.assets/xxx.png)`**。
5. 若有新 tag，在 **`_config.yml`** 的 **`tag_list`** 里加一项。
6. **构建或推送前** 运行一次 **`python sync_img_posts.py 3`**，再执行 `jekyll build` 或推送到 GitHub。

## 5. 脚本命令 3 在做什么（简要）

- 遍历所有 `_posts/*.md`，若 front matter 里有 **`asset-dir`**（如 `HiCPlot.assets`）：
  - 从 **`_posts/HiCPlot.assets/`** 复制到 **`assets/HiCPlot.assets/`**（按文件更新时间，有更新才覆盖）。
- 若没有 `asset-dir` 只有旧的 **`img-prefix`**，则仍按旧逻辑复制到 **`img/`**，保证老文章还能显示。

这样本地只维护 `_posts` 下那一份图，Typora 和 HTML 用的都是「同一套」图，只是 HTML 通过构建前复制到 `assets/` 来访问。
